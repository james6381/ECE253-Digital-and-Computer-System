.section	.vectors, "ax"
B			_start
B			SERVICE_UND
B			SERVICE_SVC
B			SERVICE_ABT_INST
B			SERVICE_ABT_DATA
.word		0
B			SERVICE_IRQ
B			SERVICE_FIQ

			.global IRQ
SERVICE_IRQ:
			PUSH {R0-R5, LR}
			LDR R4, = MPCORE_GIC_CPUIF
			LDR R5, [R4, #ICCIAR]

PRIV_TIMER_CHECK:
			CMP R5, #MPCORE_PRIV_TIMER_IRQ
			BNE KEYS_CHECK
			
			BL PRIV_TIMER_ISR
			B EXIT_IRQ
KEYS_CHECK:
			CMP R5, #KEYS_IRQ
UNEXPECTED:	BNE UNEXPECTED

			BL KEYS_IRQ
EXIT_IRQ:	
			STR R5, [R4, #ICCEOIR]
			POP {R0-R5, LR}
			SUBS PC, LR, #4
			
SERVICE_SVC:
			PUSH {R0-R5, LR}
			LDR R4, = MPCORE_GIC_CPUIF
			LDR R5, [R4, #ICCIAR]
			
SERVICE_UND:
			PUSH {R0-R5, LR}
			LDR R4, = MPCORE_GIC_CPUIF
			LDR R5, [R4, #ICCIAR]
			
SERVICE_ABT_DATA:
			PUSH {R0-R5, LR}
			LDR R4, = MPCORE_GIC_CPUIF
			LDR R5, [R4, #ICCIAR]
			
SERVICE_ABT_INST:
			PUSH {R0-R5, LR}
			LDR R4, = MPCORE_GIC_CPUIF
			LDR R5, [R4, #ICCIAR]
			
SERVICE_FIQ:
			PUSH {R0-R5, LR}
			LDR R4, = MPCORE_GIC_CPUIF
			LDR R5, [R4, #ICCIAR]



CONFIG_GIC:
	PUSH {LR}
	LDR R5, = MPCORE_GIC_CPUIF
	LDR R7, [R5, #ICCIAR]		//Read the interrupt ID